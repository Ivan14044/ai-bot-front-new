System.register(["./index-legacy-DrOZILrB.js"],function(t,e){"use strict";var s,n,o,l,i,r,a,u,c,p,d,g,h;return{setters:[t=>{s=t.P,n=t.Q,o=t.b,l=t.d,i=t.r,r=t.a,a=t.K,u=t.p,c=t.X,p=t.x,d=t.e,g=t.o,h=t.j}],execute:function(){const e=s("browserSessions",{state:()=>({url:null,pid:null,port:null}),actions:{async startSession(t){try{var e;const s=(null===(e=o().user)||void 0===e||null===(e=e.extension_settings)||void 0===e?void 0:e.uiLanguage)||"en",l=await n.get("/browser/new",{params:{service_id:null!=t?t:void 0,uiLanguage:s}}),{pid:i,port:r,url:a}=l.data;return this.pid=i,this.port=r,this.url=a,{pid:i,port:r,url:a}}catch(s){return console.error("Error while starting browser session:",s),null}},async stopSession(t){const e="number"==typeof t?t:this.pid;if(e)try{await n.post("/browser/stop",{pid:e}),this.pid===e&&(this.pid=null,this.port=null,this.url=null)}catch(s){console.error("Error while stopping session by PID:",s)}},async stopSessionByPort(t){const e="number"==typeof t?t:this.port;if(e)try{await n.post("/browser/stop",{port:e}),this.port===e&&(this.pid=null,this.port=null,this.url=null)}catch(s){console.error("Error while stopping session by port:",s)}},async stopAllSessions(t=!1){try{await n.post("/browser/stop_all",t?{clean:!0}:{}),this.pid=null,this.port=null,this.url=null}catch(e){console.error("Error while stopping all sessions:",e)}},async listSessions(){try{return(await n.get("/browser/list")).data}catch(t){return console.error("Error while listing sessions:",t),null}}}}),w={BASE_URL:"/ai-bot-front-new/",DEV:!1,LEGACY:!0,MODE:"production",PROD:!0,SSR:!1},v={class:"fixed inset-0"},y=["src"];t("default",l({__name:"SessionStart",setup(t){const s=i(null),n=i(!1),l=i(!1),S=r(),m=e(),f=o(),b=a(),{checkPluginInstalled:E}=c();let P=null,k=null;u(async()=>{const t=(()=>{const t=S.params.id,e=t?Number(t):NaN;return Number.isFinite(e)?e:null})();await b.fetchData();const e=await E();console.log("Plugin check result:",e),e.isInstalled?(console.log("Plugin already installed, starting session..."),n.value=!0,_(t)):(k=e=>{const{pluginInstalled:s,pluginSkipped:o}=e.detail||{};console.log("SessionStart: Plugin status received:",{pluginInstalled:s,pluginSkipped:o}),(s||o)&&(console.log("SessionStart: Starting session logic..."),n.value=!0,_(t))},window.addEventListener("app:plugin-status",k),console.log("Plugin not installed, showing modal..."),window.dispatchEvent(new CustomEvent("app:check-plugin-status")))});const _=async t=>{if(n.value)if(l.value||s.value)console.log("Session already started, skipping duplicate call");else try{l.value=!0,console.log("Starting session logic...");const e=await m.startSession(t);if(!e)return console.error("Failed to start browser session",e),void(l.value=!1);s.value=e.url,P=window.setTimeout(()=>{window.dispatchEvent(new CustomEvent("app:hide-loader"));const e=t?b.getById(t):void 0,s=null==e?void 0:e.params;if(null!=s&&s.title&&"string"==typeof s.title&&s.title.length>0&&(document.title=s.title),null!=s&&s.icon&&"string"==typeof s.icon&&s.icon.length>0){const t=s.icon,e=/^https?:\/\//i.test(t)?t:`${(null==w?void 0:w.VITE_APP_DOMAIN)||""}${t}`,n=e.endsWith(".ico")?"image/x-icon":"image/png";((t,e)=>{let s=document.querySelector("link[rel='icon']");s||(s=document.createElement("link"),s.rel="icon",document.head.appendChild(s)),s.type=e,s.href=t})(e,n)}},5250),f.update({browser_session_pid:e.pid}).catch(t=>{console.error("Failed to save PID to user:",t)})}catch(e){console.error("Error in startSessionLogic:",e),l.value=!1}else console.log("Cannot start session: plugin not installed and not skipped")};return p(()=>{null!==P&&(clearTimeout(P),P=null),k&&(window.removeEventListener("app:plugin-status",k),k=null)}),(t,e)=>(g(),d("div",v,[s.value?(g(),d("iframe",{key:0,src:s.value,class:"fixed inset-0 w-screen h-screen",style:{border:"0"}},null,8,y)):h("",!0)]))}}))}}});
