import{P as S,Q as m,d as B,r as N,s as P,e as h,o as y,H as j,h as v,a5 as u}from"./index-D06XNq7w.js";const k=S("articles",{state:()=>({articleById:{},categories:[],articlesByKey:{},loadedByKey:{},loaded:{categories:!1},paginatedItems:[],paginatedTotal:0,paginatedParams:{limit:12,offset:0,categoryId:void 0},paginatedCache:{}}),getters:{getArticles:t=>e=>{var i;const o=typeof e=="number"?"l".concat(e):"all";return(i=t.articlesByKey[o])!=null?i:[]},getLocalizedArticles:t=>(e,o)=>{var a;const i=typeof o=="number"?"l".concat(o):"all";return((a=t.articlesByKey[i])!=null?a:[]).filter(r=>Number.isFinite(r.id)).map(r=>{var d,c;const n=r.translations.find(l=>l.locale===e);return{...r,title:(d=n==null?void 0:n.title)!=null?d:"No title",excerpt:n!=null&&n.content?String(n.content).slice(0,140):"",short:n!=null&&n.short?String(n.short):n!=null&&n.content?String(n.content).slice(0,140):"",dateString:r.date instanceof Date?r.date.toISOString():String((c=r.date)!=null?c:"")}})},getLocalizedPaginatedArticles:t=>e=>{var o;return((o=t.paginatedItems)!=null?o:[]).filter(i=>Number.isFinite(i.id)).map(i=>{var a,r;const s=i.translations.find(n=>n.locale===e);return{...i,title:(a=s==null?void 0:s.title)!=null?a:"No title",excerpt:s!=null&&s.content?String(s.content).slice(0,140):"",short:s!=null&&s.short?String(s.short):s!=null&&s.content?String(s.content).slice(0,140):"",dateString:i.date instanceof Date?i.date.toISOString():String((r=i.date)!=null?r:"")}})},getCategoryById:t=>e=>t.categories.find(o=>o.id===e)},actions:{getPaginatedKey(t){var s,a;const e=(s=t.limit)!=null?s:12,o=(a=t.offset)!=null?a:0,i=typeof t.categoryId=="number"?t.categoryId:"all";return"l".concat(e,"-o").concat(o,"-c").concat(i)},hasCachedPage(t){const e=this.getPaginatedKey(t);return!!this.paginatedCache[e]},normalizeImagePath(t){return!t||typeof t!="string"?null:t},transformTranslations(t){return Array.isArray(t)?t.map(e=>({locale:e.locale,title:e.title,content:e.content,short:e.short})):t&&typeof t=="object"?Object.entries(t).map(([o,i])=>{var s,a,r;return{locale:o,title:(s=i==null?void 0:i.title)!=null?s:"",content:(a=i==null?void 0:i.content)!=null?a:"",short:(r=i==null?void 0:i.short)!=null?r:""}}):[]},transformCategories(t){return Array.isArray(t)?t.map(e=>{var o;return{id:e.id,name:e.name,translations:(o=e.translations)!=null?o:void 0}}):[]},transformListItem(t){var a,r,n,d,c;const e=this.transformCategories((r=(a=t.category)!=null?a:t.categories)!=null?r:[]),o=this.transformTranslations((n=t.translations)!=null?n:[]),i=(c=(d=t.date)!=null?d:t.created_at)!=null?c:new Date().toISOString(),s=this.normalizeImagePath(t.img);return{id:Number(t.id),categories:e,translations:o,img:s,date:new Date(i)}},transformDetailData(t){var a,r,n,d,c;const e=this.transformCategories((r=(a=t.categories)!=null?a:t.category)!=null?r:[]),o=this.transformTranslations((n=t.translations)!=null?n:[]),i=(c=(d=t.date)!=null?d:t.created_at)!=null?c:new Date().toISOString(),s=this.normalizeImagePath(t.img);return{id:Number(t.id),categories:e,translations:o,img:s,date:new Date(i)}},async fetchArticles(t){const e=typeof t=="number"?"l".concat(t):"all";if(!this.loadedByKey[e])try{const i=(await m.get("/articles",{params:typeof t=="number"?{limit:t}:void 0})).data,a=(Array.isArray(i==null?void 0:i.items)?i.items:Array.isArray(i)?i:[]).map(r=>this.transformListItem(r)).filter(r=>Number.isFinite(r.id));this.articlesByKey[e]=a;for(const r of a){const n=Number(r.id);Number.isFinite(n)&&(this.articleById[n]||(this.articleById[n]=r))}this.loadedByKey[e]=!0}catch(o){console.error("Error fetching articles:",o)}},async fetchArticlesPage(t){var r,n,d;const e=(r=t.limit)!=null?r:12,o=(n=t.offset)!=null?n:0,i=t.categoryId,s=this.getPaginatedKey({limit:e,offset:o,categoryId:i}),a=this.paginatedCache[s];if(a){this.paginatedItems=a.items,this.paginatedTotal=a.total,this.paginatedParams={limit:e,offset:o,categoryId:i};for(const c of this.paginatedItems){const l=Number(c.id);Number.isFinite(l)&&(this.articleById[l]||(this.articleById[l]=c))}return}try{const l=(await m.get("/articles",{params:{limit:e,offset:o,...i?{category_id:i}:{}}})).data,p=Number((d=l==null?void 0:l.total)!=null?d:0),b=Array.isArray(l==null?void 0:l.items)?l.items:[];this.paginatedItems=b.map(g=>this.transformListItem(g)).filter(g=>Number.isFinite(g.id));for(const g of this.paginatedItems){const f=Number(g.id);Number.isFinite(f)&&(this.articleById[f]||(this.articleById[f]=g))}this.paginatedTotal=p,this.paginatedParams={limit:e,offset:o,categoryId:i},this.paginatedCache[s]={items:this.paginatedItems,total:this.paginatedTotal}}catch(c){console.error("Error fetching paginated articles:",c),this.paginatedItems=[],this.paginatedTotal=0,this.paginatedParams={limit:12,offset:0,categoryId:t.categoryId}}},async fetchArticleById(t){var o,i;const e=Number(t);if(!this.articleById[e])try{const a=(o=(await m.get("/articles/".concat(e))).data)!=null?o:null;if(!a)return;const r=this.transformDetailData(a);this.articleById[e]=r}catch(s){if(((i=s==null?void 0:s.response)==null?void 0:i.status)===404)throw new Error("404");console.error("Error fetching article detail:",s)}},async fetchCategories(){if(!this.loaded.categories)try{const e=(await m.get("/categories")).data;this.categories=Array.isArray(e)?this.transformCategories(e):[],this.loaded.categories=!0}catch(t){console.error("Error fetching categories:",t)}}}}),z=["data-original-url"],A=["src","alt"],I="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODgiIGhlaWdodD0iODgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgc3Ryb2tlPSIjMDAwIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBvcGFjaXR5PSIuMyIgZmlsbD0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIzLjciPjxyZWN0IHg9IjE2IiB5PSIxNiIgd2lkdGg9IjU2IiBoZWlnaHQ9IjU2IiByeD0iNiIvPjxwYXRoIGQ9Im0xNiA1OCAxNi0xOCAzMiAzMiIvPjxjaXJjbGUgY3g9IjUzIiBjeT0iMzUiIHI9IjciLz48L3N2Zz4KCg==",C=B({inheritAttrs:!1,__name:"ImageWithFallback",props:{src:{},alt:{},style:{}},setup(t){const e=t,o=N(!1);function i(){o.value=!0}const s=e.style,a=P(()=>!e.src||e.src==="null"||e.src==="undefined"?I:e.src);return(r,n)=>(y(),h("div",{class:"block w-full h-full bg-gray-100 overflow-hidden",style:j(v(s))},[o.value?(y(),h("img",u({key:0,src:I,alt:"Error loading image",class:"w-full h-full"},r.$attrs,{"data-original-url":r.src}),null,16,z)):(y(),h("img",u({key:1,src:a.value,alt:r.alt},r.$attrs,{onError:i,class:"w-full h-full object-cover"}),null,16,A))],4))}});export{C as _,k as u};
